# DeepRoughVol Configuration
# --------------------------
# All parameters centralized for reproducibility

# Data Configuration
data:
  # VIX sources (for training in Q-measure)
  source: "data/TVC_VIX, 15.csv"       # VIX 15min for IV training (Q-measure)
  vix_files:
    5:  "data/TVC_VIX, 5.csv"
    10: "data/TVC_VIX, 10.csv"
    15: "data/TVC_VIX, 15.csv"
    30: "data/TVC_VIX, 30.csv"
  # SPX sources (for P-measure roughness / realized vol)
  rv_source: "data/SP_SPX, 5.csv"
  spx_files:
    5:  "data/SP_SPX, 5.csv"
    30: "data/SP_SPX, 30.csv"
  # Historical S&P 500 daily (for pricing benchmarks)
  spx_daily: "data/data_^GSPC_2010-01-01_2023-01-01.csv"
  data_type: "vix"                      # 'realized_vol' or 'vix'
  segment_length: 120                   # Path length for training (~4.6 trading days at 15min)
  stride_ratio: 0.5                     # 50% overlap between paths
  rv_window: 78                         # Window for RV calculation (78 x 5min = 1 trading day)
  rv_bar_interval_min: 5                # Bar interval for RV source (5min SPX)
  # Temporal coherence
  max_gap_hours: 4                      # Max acceptable gap between consecutive points
  trading_hours_per_day: 6.5            # NYSE trading hours (9:30 - 16:00)
  options_cache_dir: "data/options_cache"

# Model Training
training:
  n_epochs: 500
  batch_size: 256
  learning_rate_init: 0.001             # 1e-3
  learning_rate_final: 0.00001          # 1e-5
  decay_steps: 500                      # Match n_epochs for full cosine decay utilization
  gradient_clip: 1.0
  lambda_mean: 10.0                     # Weight for mean penalty loss
  warmup_steps: 50                      # Linear LR warmup (stabilizes early signature feedback)
  validation_split: 0.15                # Fraction of data held out for validation
  early_stopping_patience: 50           # Epochs without improvement before stopping
  # Mean penalty mode:
  #   "global"   — single scalar E[V] matching (fast, default)
  #   "marginal" — per-step E[V_t] matching (tighter Jensen correction,
  #                Bayer & Stemper 2018)
  mean_penalty_mode: "global"

# Neural SDE Architecture
neural_sde:
  sig_truncation_order: 3
  mlp_width: 64
  mlp_depth: 3
  drift_scale: 0.5                      # Constraints neural drift authority
  diffusion_min: 0.1
  diffusion_max: 1.6
  learn_ou_params: true                 # Allow kappa/theta to be learned during training
  # Physical Prior (Ornstein-Uhlenbeck) — initial values, learnable if above is true
  kappa: 2.72                           # Mean-reversion speed (from VIX futures calibration)
  theta: -3.5                           # Long-term log-variance target (exp(-3.5) ~ 0.03 ~ 17% vol)
  # Log-variance clipping bounds (configurable)
  # Default: [-7, 2] → variance in [~0.001, ~7.4] (vol ~3% to ~272%)
  # Wider than previous [-5, 1] to avoid truncating tails in extreme regimes.
  # For equity VIX: [-7, 2] covers VIX ∈ [3%, 272%], sufficient for all
  # historical regimes including 2008 crisis (VIX ~80%) and COVID (VIX ~82%).
  log_v_clip_min: -7.0
  log_v_clip_max: 2.0

# Simulation Configuration
simulation:
  n_steps: 120                          # Match segment_length for consistency
  T: 0.01832                            # Real horizon: 120 bars * 15min / (252 * 6.5h * 60min) years ≈ 4.6 days
  n_paths: 5000                         # Monte Carlo paths
  bars_per_day: 26                      # 6.5 trading hours / 15 min
  bar_interval_min: 15                  # VIX bar interval in minutes

# Rough Bergomi Benchmark
bergomi:
  hurst: 0.07                           # Roughness (H < 0.15 for rough regime)
  eta: 1.9                              # Vol-of-vol
  rho: -0.7                             # Spot-vol correlation (leverage)
  xi0: 0.0225                           # Initial forward variance (VIX~15% → 0.15²)
  # fBM simulation method:
  #   "volterra"      — Riemann-Liouville fBM via discretized Volterra kernel (default).
  #                      Correct for rBergomi (Bayer, Friz & Gatheral 2016).
  #                      Exact spot-vol correlation. O(N²) memory.
  #   "davies_harte"  — Standard fBM via circulant embedding / FFT.
  #                      Faster O(N log N) but different covariance structure
  #                      for H ≠ 0.5, no spot-vol correlation guarantee.
  #                      Reference: Dietrich & Newsam (1997), Dieker (2004).
  fBm_method: "volterra"

# Pricing Configuration
pricing:
  strike: 100.0
  barrier: 90.0
  spot: 100.0
  risk_free_rate: 0.05
  maturity: 0.01832                     # Matches T from simulation
  n_mc_paths: 5000                      # Monte Carlo paths for pricing

# Backtesting Configuration
backtesting:
  n_days: 30                            # Number of backtest days
  n_mc_paths: 10000                     # MC paths per scenario (speed vs accuracy)
  rv_source: "data/SP_SPX, 30.csv"      # SPX data for RV scenarios
  maturity_days: 30                     # Option maturity in days
  moneyness_range: [-0.15, 0.15]        # log-moneyness bounds
  n_strikes: 11                         # Number of strikes in smile

# Output paths
outputs:
  dir: "outputs"
  model_dir: "outputs/models"
  plots_dir: "outputs/plots"
  backtest: "outputs/backtest_results.json"
  calibration: "outputs/advanced_calibration.json"
